import{_ as t}from"./plugin-vue_export-helper.21dcd24c.js";import{o as p,c as e,a as n,b as o,d as s,e as i,r as c}from"./app.4b0e8564.js";const l={},u=s(`<h2 id="\u591A\u8FDB\u7A0B\u7A0B\u5E8F\u4F8B\u5B50" tabindex="-1"><a class="header-anchor" href="#\u591A\u8FDB\u7A0B\u7A0B\u5E8F\u4F8B\u5B50" aria-hidden="true">#</a> \u591A\u8FDB\u7A0B\u7A0B\u5E8F\u4F8B\u5B50</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> argparse
<span class="token keyword">import</span> redis
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool<span class="token punctuation">,</span> Process

parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&#39;PyTorch MM Training&#39;</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--port&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&quot;port id&quot;</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--file&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&quot;paths for train instances&quot;</span><span class="token punctuation">)</span>
args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

host <span class="token operator">=</span> <span class="token string">&#39;127.0.0.1&#39;</span>
port <span class="token operator">=</span> args<span class="token punctuation">.</span>port

<span class="token comment"># r = redis.Redis(host=host, port=port)</span>

train_file <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token builtin">file</span>

<span class="token keyword">def</span> <span class="token function">worker_i</span><span class="token punctuation">(</span>train_file<span class="token punctuation">,</span> i<span class="token punctuation">,</span> nums<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span>host<span class="token punctuation">,</span> port<span class="token operator">=</span>port<span class="token punctuation">)</span>
    k <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        iter_ <span class="token operator">=</span> tqdm<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>train_file<span class="token punctuation">,</span> <span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        iter_ <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>train_file<span class="token punctuation">,</span> <span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> info <span class="token keyword">in</span> iter_<span class="token punctuation">:</span>
        <span class="token keyword">if</span> k <span class="token operator">%</span> nums <span class="token operator">==</span> i<span class="token punctuation">:</span> <span class="token comment"># \u5C06\u591A\u4E2A\u4EFB\u52A1\u5206\u6210nums\u4EFD</span>
            r<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> info<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        k <span class="token operator">+=</span> <span class="token number">1</span>
process_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

nums <span class="token operator">=</span> <span class="token number">8</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>worker_i<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>train_file<span class="token punctuation">,</span> i<span class="token punctuation">,</span> nums<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    process_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> process_list<span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;\u5199\u5165\u5B8C\u6210&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="python-\u4E2D\u7684\u4E09\u79CD\u5E76\u53D1\u7F16\u7A0B\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#python-\u4E2D\u7684\u4E09\u79CD\u5E76\u53D1\u7F16\u7A0B\u65B9\u5F0F" aria-hidden="true">#</a> Python \u4E2D\u7684\u4E09\u79CD\u5E76\u53D1\u7F16\u7A0B\u65B9\u5F0F</h2><p><img src="http://timpcfan-site.cdn.bcebos.com/imgs/tch30Z.png" alt="tch30Z" loading="lazy"></p><h3 id="\u4E09\u79CD\u65B9\u5F0F-\u591A\u7EBF\u7A0B-thread-\u3001\u591A\u8FDB\u7A0B-process-\u3001\u534F\u7A0B-coroutine" tabindex="-1"><a class="header-anchor" href="#\u4E09\u79CD\u65B9\u5F0F-\u591A\u7EBF\u7A0B-thread-\u3001\u591A\u8FDB\u7A0B-process-\u3001\u534F\u7A0B-coroutine" aria-hidden="true">#</a> \u4E09\u79CD\u65B9\u5F0F\uFF1A\u591A\u7EBF\u7A0B\uFF08Thread\uFF09\u3001\u591A\u8FDB\u7A0B\uFF08Process\uFF09\u3001\u534F\u7A0B\uFF08Coroutine\uFF09</h3><h3 id="\u4EC0\u4E48\u662F-cpu-\u5BC6\u96C6\u578B\u8BA1\u7B97\u3001io-\u5BC6\u96C6\u578B\u8BA1\u7B97" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662F-cpu-\u5BC6\u96C6\u578B\u8BA1\u7B97\u3001io-\u5BC6\u96C6\u578B\u8BA1\u7B97" aria-hidden="true">#</a> \u4EC0\u4E48\u662F CPU \u5BC6\u96C6\u578B\u8BA1\u7B97\u3001IO \u5BC6\u96C6\u578B\u8BA1\u7B97</h3><ul><li>CPU \u5BC6\u96C6\u578B\u8BA1\u7B97\uFF08CPU-bound\uFF09\uFF1A <ul><li>\u4F8B\u5982\uFF1A\u538B\u7F29\u89E3\u538B\u7F29\u3001\u52A0\u5BC6\u89E3\u5BC6</li></ul></li><li>IO \u5BC6\u96C6\u578B\u8BA1\u7B97\uFF08I/O bound\uFF09\uFF1A <ul><li>\u722C\u866B\u3001\u6587\u4EF6\u5904\u7406\u7B49</li></ul></li></ul><h3 id="\u591A\u7EBF\u7A0B\u3001\u591A\u8FDB\u7A0B\u3001\u534F\u7A0B\u7684\u5BF9\u6BD4" tabindex="-1"><a class="header-anchor" href="#\u591A\u7EBF\u7A0B\u3001\u591A\u8FDB\u7A0B\u3001\u534F\u7A0B\u7684\u5BF9\u6BD4" aria-hidden="true">#</a> \u591A\u7EBF\u7A0B\u3001\u591A\u8FDB\u7A0B\u3001\u534F\u7A0B\u7684\u5BF9\u6BD4</h3><ul><li>\u591A\u8FDB\u7A0B Process\uFF08multiprocessing\uFF09 <ul><li>\u4F18\u70B9\uFF1A\u53EF\u4EE5\u5229\u7528\u591A\u6838 CPU \u5E76\u884C\u8FD0\u7B97</li><li>\u7F3A\u70B9\uFF1A\u5360\u7528\u8D44\u6E90\u6700\u591A\u3001\u53EF\u542F\u52A8\u6570\u76EE\u6BD4\u7EBF\u7A0B\u5C11</li><li>\u9002\u7528\u4E8E\uFF1ACPU \u5BC6\u96C6\u578B\u8BA1\u7B97</li></ul></li><li>\u591A\u7EBF\u7A0B Thread\uFF08threading\uFF09 <ul><li>\u4F18\u70B9\uFF1A\u76F8\u6BD4\u8FDB\u7A0B\uFF0C\u66F4\u8F7B\u91CF\u7EA7\u3001\u5360\u7528\u8D44\u6E90\u5C11</li><li>\u7F3A\u70B9\uFF1A <ul><li>\u76F8\u6BD4\u8FDB\u7A0B\uFF1A\u591A\u7EBF\u7A0B\u53EA\u80FD\u5E76\u53D1\u6267\u884C\uFF0C\u4E0D\u80FD\u5229\u7528\u591A CPU\uFF08GIL\uFF09</li><li>\u76F8\u6BD4\u534F\u7A0B\uFF1A\u542F\u52A8\u6570\u76EE\u6709\u9650\u5236\uFF0C\u5360\u7528\u5185\u5B58\u8D44\u6E90\uFF0C\u6709\u7EBF\u7A0B\u5207\u6362\u5F00\u9500</li></ul></li><li>\u9002\u7528\u4E8E\uFF1AIO \u5BC6\u96C6\u578B\u8BA1\u7B97\u3001\u540C\u65F6\u5141\u8BB8\u7684\u4EFB\u52A1\u6570\u76EE\u8981\u6C42\u4E0D\u591A</li></ul></li><li>\u534F\u7A0B Coroutine\uFF08asyncio\uFF09 <ul><li>\u4F18\u70B9\uFF1A\u5185\u5B58\u5F00\u9500\u6700\u5C11\u3001\u542F\u52A8\u534F\u7A0B\u6570\u91CF\u6700\u591A</li><li>\u7F3A\u70B9\uFF1A\u652F\u6301\u7684\u5E93\u6709\u9650\u5236\uFF08aiohttp vs requests\uFF09\u3001\u4EE3\u7801\u5B9E\u73B0\u590D\u6742</li><li>\u9002\u7528\u4E8E\uFF1AIO \u5BC6\u96C6\u578B\u8BA1\u7B97\u3001\u9700\u8981\u8D85\u591A\u4EFB\u52A1\u8FD0\u884C\u3001\u4F46\u6709\u73B0\u6210\u5E93\u652F\u6301\u7684\u573A\u666F</li></ul></li></ul><h3 id="\u600E\u6837\u6839\u636E\u4EFB\u52A1\u9009\u62E9\u5BF9\u5E94\u6280\u672F" tabindex="-1"><a class="header-anchor" href="#\u600E\u6837\u6839\u636E\u4EFB\u52A1\u9009\u62E9\u5BF9\u5E94\u6280\u672F" aria-hidden="true">#</a> \u600E\u6837\u6839\u636E\u4EFB\u52A1\u9009\u62E9\u5BF9\u5E94\u6280\u672F</h3><p><img src="http://timpcfan-site.cdn.bcebos.com/imgs/UsvTjR.png" alt="UsvTjR" loading="lazy"></p><h2 id="\u5168\u5C40\u89E3\u91CA\u5668\u9501-gil-global-interpreter-lock" tabindex="-1"><a class="header-anchor" href="#\u5168\u5C40\u89E3\u91CA\u5668\u9501-gil-global-interpreter-lock" aria-hidden="true">#</a> \u5168\u5C40\u89E3\u91CA\u5668\u9501 GIL\uFF08Global Interpreter Lock\uFF09</h2><p>Python \u901F\u5EA6\u6162\u7684\u4E24\u5927\u539F\u56E0\uFF1A</p><ul><li>\u52A8\u6001\u7C7B\u578B\u8BED\u8A00\uFF0C\u8FB9\u89E3\u91CA\u8FB9\u6267\u884C</li><li>GIL\uFF0C\u65E0\u6CD5\u5229\u7528\u591A\u6838 CPU \u5E76\u53D1\u6267\u884C</li></ul><p>\u5168\u5C40\u89E3\u91CA\u5668\u9501\uFF1A</p><ul><li>\u662F\u8BA1\u7B97\u673A\u7A0B\u5E8F\u8BBE\u8BA1\u8BED\u8A00\u89E3\u91CA\u5668\u7528\u4E8E\u540C\u6B65\u7EBF\u7A0B\u7684\u4E00\u79CD\u673A\u5236\uFF0C\u5B83\u4F7F\u5F97\u4EFB\u4F55\u65F6\u523B\u4EC5\u6709\u4E00\u4E2A\u7EBF\u7A0B\u5728\u6267\u884C\u3002</li><li>\u5373\u4FBF\u5728\u591A\u6838\u5904\u7406\u5668\u4E0A\uFF0C\u4F7F\u7528 GIL \u7684\u89E3\u91CA\u5668\u4E5F<strong>\u53EA\u80FD\u5141\u8BB8\u540C\u4E00\u65F6\u95F4\u6267\u884C\u4E00\u4E2A\u7EBF</strong>\u7A0B\u3002\u76F8\u6BD4\u5E76\u53D1\u52A0\u901F\u7684 C++/JAVA \u4F1A\u6162\u5F88\u591A\u3002</li><li>\u539F\u56E0\u8BE6\u89E3 <ul><li>\u4E3A\u4E86\u89E3\u51B3\u591A\u7EBF\u7A0B\u4E4B\u95F4\u6570\u636E\u5B8C\u6574\u6027\u548C\u72B6\u6001\u540C\u6B65\u95EE\u9898\u3002</li><li>Python \u4E2D\u5BF9\u8C61\u7684\u7BA1\u7406\uFF0C\u7EF4\u62A4\u4E86\u6BCF\u4E2A\u5BF9\u8C61\u7684\u5F15\u7528\u8BA1\u6570\uFF0C\u5728\u591A\u7EBF\u7A0B\u65F6\uFF0C\u4E3A\u4E86\u4FDD\u8BC1\u5F15\u7528\u8BA1\u6570\u7684\u4E00\u81F4\u6027\uFF0C\u4F7F\u7528\u4E86\u9501\u7684\u673A\u5236\u3002</li></ul></li></ul><p>\u600E\u6837\u89C4\u907F GIL \u5E26\u6765\u7684\u9650\u5236\uFF1A</p><ul><li>\u90A3 Python \u4E2D\u7684\u7EBF\u7A0B\u65E0\u6CD5\u540C\u65F6\u8FD0\u884C\uFF0C\u4E3A\u4EC0\u4E48\u8FD8\u8981\u4F7F\u7528\u591A\u7EBF\u7A0B\u673A\u5236\u5462\uFF1F\u591A\u7EBF\u7A0B\u673A\u5236\u5728 Python \u4E2D\u4F9D\u7136\u662F\u6709\u7528\u7684\uFF0C\u7531\u4E8E<strong>IO \u5BC6\u96C6\u578B\u8BA1\u7B97</strong>\uFF0C\u56E0\u4E3A IO \u671F\u95F4\uFF0C\u7EBF\u7A0B\u4F1A\u91CA\u653E GIL\uFF0C\u5B9E\u73B0 CPU \u548C IO \u7684\u5E76\u884C\uFF0C\u56E0\u6B64\u591A\u7EBF\u7A0B\u7528\u4E8E IO \u5BC6\u96C6\u578B\u8BA1\u7B97\u4F9D\u7136\u53EF\u4EE5\u5927\u5E45\u63D0\u5347\u901F\u5EA6\u3002</li><li>\u4F7F\u7528 multiprocessing \u7684\u591A\u8FDB\u7A0B\u673A\u5236\u5B9E\u73B0\u5E76\u884C\u8BA1\u7B97\u3001\u5229\u7528\u591A\u6838 CPU \u4F18\u52BF\u3002</li></ul><h2 id="python-\u591A\u7EBF\u7A0B\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#python-\u591A\u7EBF\u7A0B\u4EE3\u7801" aria-hidden="true">#</a> Python \u591A\u7EBF\u7A0B\u4EE3\u7801</h2><h3 id="\u76F4\u63A5\u521B\u5EFA\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u76F4\u63A5\u521B\u5EFA\u7EBF\u7A0B" aria-hidden="true">#</a> \u76F4\u63A5\u521B\u5EFA\u7EBF\u7A0B</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> threading

<span class="token keyword">def</span> <span class="token function">craw</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 1. \u51C6\u5907\u4E00\u4E2A\u51FD\u6570</span>
	r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">multi_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 2. \u51C6\u5907\u4E00\u4E2A\u7EBF\u7A0Blist</span>
	<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
		threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>  <span class="token comment"># 3. \u521B\u5EFA\u7EBF\u7A0B</span>
			threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>craw<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">)</span>

	<span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>
		thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 4. \u542F\u52A8\u7EBF\u7A0B</span>

	<span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>
		thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 5. \u7B49\u5F85\u7ED3\u675F</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4F7F\u7528\u7EBF\u7A0B\u6C60threadpoolexecutor" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u7EBF\u7A0B\u6C60threadpoolexecutor" aria-hidden="true">#</a> \u4F7F\u7528\u7EBF\u7A0B\u6C60<strong>ThreadPoolExecutor</strong></h3><p>\u7528\u6CD5 1\uFF1A\u4F7F\u7528 map \u51FD\u6570\uFF08\u6240\u6709\u4EFB\u52A1\u4E00\u8D77\u63D0\u4EA4\uFF09</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor
<span class="token keyword">with</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>
		result <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>craw<span class="token punctuation">,</span> urls<span class="token punctuation">)</span>
		<span class="token comment"># map\u7684\u7ED3\u679C\u548C\u5165\u53C2\u7684\u987A\u5E8F\u5BF9\u5E94\u7684</span>
		<span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
				<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7528\u6CD5 2\uFF1Afuture \u6A21\u5F0F\uFF0C\u66F4\u5F3A\u5927\uFF08\u4E00\u4E2A\u4EFB\u52A1\u4E00\u4E2A\u4EFB\u52A1\u63D0\u4EA4\uFF09</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor<span class="token punctuation">,</span> as_completed
<span class="token keyword">with</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>
		<span class="token comment"># \u4F7F\u7528 dict \u53EF\u4EE5\u77E5\u9053future\u5BF9\u5E94\u7684\u5165\u53C2</span>
		futures <span class="token operator">=</span> <span class="token punctuation">{</span>pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>craw<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span> url
								<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">}</span>
		<span class="token comment"># \u65B9\u5F0F1: \u7ED3\u679C\u4ECD\u7136\u6309\u987A\u5E8F</span>
		<span class="token keyword">for</span> future<span class="token punctuation">,</span> url <span class="token keyword">in</span> futures<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token comment"># \u65B9\u5F0F2: \u4F7F\u7528 as_completed \u987A\u5E8F\u662F\u4E0D\u5B9A\u7684</span>
		<span class="token keyword">for</span> future <span class="token keyword">in</span> as_completed<span class="token punctuation">(</span>futures<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># \u6CE8\uFF1A\u5B57\u5178\u7684\u904D\u5386\u662F\u904D\u5386key</span>
				url <span class="token operator">=</span> futures<span class="token punctuation">[</span>future<span class="token punctuation">]</span>
				<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86">\u7EBF\u7A0B\u6C60\u539F\u7406</a></p><h2 id="python-\u591A\u8FDB\u7A0B\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#python-\u591A\u8FDB\u7A0B\u4EE3\u7801" aria-hidden="true">#</a> Python \u591A\u8FDB\u7A0B\u4EE3\u7801</h2><p>\u591A\u7EBF\u7A0B threading \u4E0E\u591A\u8FDB\u7A0B multiprocessing \u7684\u4EE3\u7801\u5BF9\u6BD4</p><p><img src="http://timpcfan-site.cdn.bcebos.com/imgs/oMERIi.png" alt="oMERIi" loading="lazy"></p><p>\u76F4\u63A5\u6539\u4E2A\u7C7B\u540D\u5C31\u80FD\u8FD0\u884C\uFF01</p><p>\u6240\u4EE5\u4EE3\u7801\u53BB\u770B <a href="#python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BB%A3%E7%A0%81">Python \u591A\u7EBF\u7A0B\u4EE3\u7801</a></p><h3 id="\u591A\u8FDB\u7A0B\u4F18\u96C5\u9000\u51FA" tabindex="-1"><a class="header-anchor" href="#\u591A\u8FDB\u7A0B\u4F18\u96C5\u9000\u51FA" aria-hidden="true">#</a> \u591A\u8FDB\u7A0B\u4F18\u96C5\u9000\u51FA</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> ctypes
<span class="token keyword">import</span> time
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> RawValue

<span class="token keyword">class</span> <span class="token class-name">CountdownTask</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_running <span class="token operator">=</span> RawValue<span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_bool<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">terminate</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_running<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>_running<span class="token punctuation">.</span>value <span class="token keyword">and</span> n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;T-minus&#39;</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
            n <span class="token operator">-=</span> <span class="token number">1</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

c <span class="token operator">=</span> CountdownTask<span class="token punctuation">(</span><span class="token punctuation">)</span>
t <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>c<span class="token punctuation">.</span>run<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Signal termination</span>
t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Wait for actual termination (if needed)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u7EBF\u7A0B\u6C60\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#\u7EBF\u7A0B\u6C60\u539F\u7406" aria-hidden="true">#</a> \u7EBF\u7A0B\u6C60\u539F\u7406</h2><h3 id="\u7EBF\u7A0B\u6C60\u7684\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#\u7EBF\u7A0B\u6C60\u7684\u539F\u7406" aria-hidden="true">#</a> \u7EBF\u7A0B\u6C60\u7684\u539F\u7406</h3><p><img src="http://timpcfan-site.cdn.bcebos.com/imgs/YPT9vT.png" alt="YPT9vT" loading="lazy"></p><h3 id="\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#\u7279\u70B9" aria-hidden="true">#</a> \u7279\u70B9</h3><ul><li>\u4F7F\u7528\u4EFB\u52A1\u961F\u5217</li><li>\u53EF\u91CD\u7528\u7EBF\u7A0B</li></ul><h3 id="\u4F18\u70B9" tabindex="-1"><a class="header-anchor" href="#\u4F18\u70B9" aria-hidden="true">#</a> \u4F18\u70B9</h3><ul><li>\u63D0\u5347\u6027\u80FD\uFF1A\u51CF\u5C11\u521B\u5EFA\u7EC8\u6B62\u7EBF\u7A0B\u5F00\u9500\uFF0C\u91CD\u7528\u7EBF\u7A0B\u8D44\u6E90</li><li>\u9002\u7528\u573A\u666F\uFF1A\u7A81\u53D1\u6027\u5927\u91CF\u8BF7\u6C42\u3001\u4F46\u4EFB\u52A1\u5904\u7406\u65F6\u95F4\u8F83\u77ED</li><li>\u9632\u5FA1\u529F\u80FD\uFF1A\u907F\u514D\u7CFB\u7EDF\u56E0\u4E3A\u521B\u5EFA\u7EBF\u7A0B\u8FC7\u591A\u5BFC\u81F4\u8D1F\u8377\u8FC7\u5927</li><li>\u4EE3\u7801\u4F18\u52BF\uFF1A\u7B80\u6D01\u65B9\u4FBF</li></ul><h2 id="\u534F\u7A0B\u7684\u539F\u7406\u4EE5\u53CA\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#\u534F\u7A0B\u7684\u539F\u7406\u4EE5\u53CA\u4EE3\u7801" aria-hidden="true">#</a> \u534F\u7A0B\u7684\u539F\u7406\u4EE5\u53CA\u4EE3\u7801</h2>`,42),r={href:"https://www.bilibili.com/video/BV1bK411A7tV?p=11",target:"_blank",rel:"noopener noreferrer"},d=i("\u30102021 \u6700\u65B0\u7248\u3011Python \u5E76\u53D1\u7F16\u7A0B\u5B9E\u6218\uFF0C\u7528\u591A\u7EBF\u7A0B\u3001\u591A\u8FDB\u7A0B\u3001\u591A\u534F\u7A0B\u52A0\u901F\u7A0B\u5E8F\u8FD0\u884C_\u54D4\u54E9\u54D4\u54E9_bilibili"),k=s(`<h3 id="\u534F\u7A0B\u7684\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#\u534F\u7A0B\u7684\u539F\u7406" aria-hidden="true">#</a> \u534F\u7A0B\u7684\u539F\u7406</h3><p>\u534F\u7A0B\uFF1A\u5728<strong>\u5355\u7EBF\u7A0B\u5185</strong>\u5B9E\u73B0\u5E76\u53D1</p><ul><li>\u6838\u5FC3\u539F\u7406\uFF1A\u7528\u4E00\u4E2A\u8D85\u7EA7\u5FAA\u73AF\uFF08\u5176\u5B9E\u5C31\u662F while true\uFF09\u5FAA\u73AF\uFF0C\u914D\u5408 IO \u591A\u8DEF\u590D\u7528\u539F\u7406\uFF08IO \u65F6 CPU \u53EF\u4EE5\u5E72\u5176\u4ED6\u4E8B\u60C5\uFF09</li><li>\u4E8E\u662F\u5728\u7B49\u5F85 IO \u65F6\uFF0CCPU \u4F1A\u540C\u65F6\u5F00\u59CB\u8BA1\u7B97\u4E0B\u4E00\u4E2A\u5FAA\u73AF\u7684 IO \u524D\u7684\u90E8\u5206\uFF0C\u5E76\u5F00\u542F\u591A\u8F6E\u5FAA\u73AF\u540C\u65F6\u8FDB\u884C\u7684\u5C40\u9762</li><li>\u7B49\u5F85 IO \u7ED3\u675F\uFF0CCPU \u5C06\u5269\u4F59\u90E8\u5206\u7684\u4EE3\u7801\u518D\u4E00\u5E76\u6267\u884C</li></ul><p><strong>\u5355\u7EBF\u7A0B\u722C\u866B\u6267\u884C\u8DEF\u5F84</strong></p><p><img src="http://timpcfan-site.cdn.bcebos.com/imgs/dFUEmJ.png" alt="dFUEmJ" loading="lazy"></p><p><strong>\u534F\u7A0B\u722C\u866B\u6267\u884C\u8DEF\u5F84</strong></p><p><img src="http://timpcfan-site.cdn.bcebos.com/imgs/OSigeS.png" alt="OSigeS" loading="lazy"></p><h3 id="\u534F\u7A0B\u7684\u4F7F\u7528\u4EE5\u53CA\u5F02\u6B65-io" tabindex="-1"><a class="header-anchor" href="#\u534F\u7A0B\u7684\u4F7F\u7528\u4EE5\u53CA\u5F02\u6B65-io" aria-hidden="true">#</a> \u534F\u7A0B\u7684\u4F7F\u7528\u4EE5\u53CA\u5F02\u6B65 IO</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio

<span class="token comment"># \u83B7\u53D6\u4E8B\u4EF6\u5FAA\u73AF\uFF08\u8D85\u7EA7\u5FAA\u73AF\uFF09</span>
loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># \u5B9A\u4E49\u534F\u7A0B</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">await</span> get_url<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

<span class="token comment"># \u521B\u5EFAtask\u5217\u8868</span>
tasks <span class="token operator">=</span> <span class="token punctuation">[</span>loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>myfunc<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>

<span class="token comment"># \u6267\u884C\u722C\u866B\u4E8B\u4EF6\u5217\u8868</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5173\u952E\u5B57<strong>async</strong>\uFF1A\u8868\u793A\u5B9A\u4E49\u4E00\u4E2A\u534F\u7A0B\u3002</p><p>\u5173\u952E\u5B57<strong>await</strong>\uFF1A\u8868\u793A\u540E\u9762\u7684\u51FD\u6570\u662F\u4E00\u4E2A\u5F02\u6B65 IO\uFF0C\u5E76\u4E14\u4E0D\u8FDB\u884C\u963B\u585E\uFF0C\u800C\u662F\u76F4\u63A5\u5728\u8D85\u7EA7\u5FAA\u73AF\u76F4\u63A5\u8FDB\u5165\u4E0B\u4E00\u4E2A\u4EFB\u52A1\u7684\u6267\u884C\uFF08\u5F53\u524D\u4EFB\u52A1\u653E\u5F03 CPU\uFF0C\u4E0B\u4E00\u4E2A\u4EFB\u52A1\u83B7\u5F97 CPU\uFF09\u3002</p><div class="custom-container warning"><p class="custom-container-title">\u6CE8\u610F</p><p>\u5F02\u6B65 IO \u4E2D\u4F9D\u8D56\u7684\u5E93\u5FC5\u987B\u652F\u6301\u5F02\u6B65 IO \u7279\u6027\uFF08\u8FD9\u8981\u6C42\u5E93\u5728 IO \u65F6\u4E0D\u80FD\u963B\u585E\uFF0C\u5426\u5219\u5207\u6362\u4E0D\u5230\u4E0B\u4E00\u4E2A\u4EFB\u52A1\u4E86\uFF09</p></div><div class="custom-container warning"><p class="custom-container-title">\u6CE8\u610F</p><p>requests \u5E93\u4E0D\u652F\u6301\u5F02\u6B65 IO\uFF0C\u9700\u8981\u4F7F\u7528 aiohttp \u5E93</p></div><p>\u4F8B\u5B50\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio<span class="token punctuation">,</span> aiohtttp

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">async_craw</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
				<span class="token keyword">async</span> <span class="token keyword">with</span> sess<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> resp<span class="token punctuation">:</span>
						result <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>

loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
tasks <span class="token operator">=</span> <span class="token punctuation">[</span>loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>async_craw<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6240\u6709\u7684\u5F02\u6B65\u5BF9\u8C61\u4E5F\u9700\u8981\u4F7F\u7528 async \u5173\u952E\u5B57\u6765\u6807\u6CE8\u3002</p><div class="custom-container info"><p class="custom-container-title">\u76F8\u5173\u4FE1\u606F</p><p>\u534F\u7A0B\u4E0E\u666E\u901A\u51FD\u6570\u8FD0\u884C\u7684\u4E0D\u540C\u70B9\u5728\u4E8E\u534F\u7A0B\u9700\u8981\u4F7F\u7528\u8D85\u7EA7\u5FAA\u73AF\u6765\u8FDB\u884C\u8C03\u5EA6\u3002</p></div><h3 id="\u534F\u7A0B\u5E76\u53D1\u5EA6\u7684\u63A7\u5236" tabindex="-1"><a class="header-anchor" href="#\u534F\u7A0B\u5E76\u53D1\u5EA6\u7684\u63A7\u5236" aria-hidden="true">#</a> \u534F\u7A0B\u5E76\u53D1\u5EA6\u7684\u63A7\u5236</h3><p>\u53EF\u4EE5\u4F7F\u7528 <a href="#%E4%BF%A1%E5%8F%B7%E9%87%8F-semaphore">\u4FE1\u53F7\u91CF Semaphore</a> \u6765\u8FDB\u884C\u63A7\u5236\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio<span class="token punctuation">,</span> aiohtttp

semaphore <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">async_craw</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">async</span> <span class="token keyword">with</span> semaphore<span class="token punctuation">:</span>  <span class="token comment"># here</span>
				<span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
						<span class="token keyword">async</span> <span class="token keyword">with</span> sess<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> resp<span class="token punctuation">:</span>
								result <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
								<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>

loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
tasks <span class="token operator">=</span> <span class="token punctuation">[</span>loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>async_craw<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u4FE1\u53F7\u91CF-semaphore" tabindex="-1"><a class="header-anchor" href="#\u4FE1\u53F7\u91CF-semaphore" aria-hidden="true">#</a> \u4FE1\u53F7\u91CF Semaphore</h2><div class="custom-container info"><p class="custom-container-title">\u76F8\u5173\u4FE1\u606F</p><p>\u4FE1\u53F7\u91CF\u4E00\u822C\u7528\u4E8E\u8BBF\u95EE\u6709\u9650\u6570\u91CF\u7684\u5171\u4EAB\u8D44\u6E90\u3002</p></div><p>\u4FE1\u53F7\u91CF\u662F\u4E00\u4E2A<strong>\u540C\u6B65\u5BF9\u8C61</strong>\uFF0C\u7528\u4E8E\u4FDD\u6301\u5728 0 \u81F3\u6307\u5B9A\u6700\u5927\u503C\u4E4B\u95F4\u7684\u4E00\u4E2A\u8BA1\u6570\u5668\u3002</p><ul><li>\u5F53\u7EBF\u7A0B\u5B8C\u6210\u4E00\u6B21\u5BF9\u6539 semaphore \u5BF9\u8C61\u7684\u7B49\u5F85\uFF08wait\uFF09\u65F6\uFF0C\u8BE5\u8BA1\u6570\u5668\u51CF\u4E00</li><li>\u5F53\u7EBF\u7A0B\u5B8C\u6210\u4E00\u6B21\u5BF9\u6539 semaphore \u5BF9\u8C61\u7684\u91CA\u653E\uFF08release\uFF09\u65F6\uFF0C\u8BE5\u8BA1\u6570\u5668\u52A0\u4E00</li><li>\u5F53\u8BA1\u6570\u5668\u4E3A 0 \u65F6\uFF0C\u7EBF\u7A0B\u7B49\u5F85\u8BE5 semaphore \u5BF9\u8C61\u4E0D\u518D\u80FD\u6210\u529F\u76F4\u5230\u8BE5 semaphore \u5BF9\u8C61\u53D8\u6210 signaled \u72B6\u6001\uFF08\u963B\u585E\uFF09 <ul><li>\u8BA1\u6570\u5668\u5927\u4E8E 0\uFF0C\u4E3A signaled \u72B6\u6001</li><li>\u8BA1\u6570\u5668\u7B49\u4E8E 0\uFF0C\u4E3A nonsignaled \u72B6\u6001</li></ul></li></ul><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># \u65B9\u6CD5\u4E00\uFF1A\u4F7F\u7528with</span>
sem <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># ...later</span>
<span class="token keyword">async</span> <span class="token keyword">with</span> sem<span class="token punctuation">:</span>
		<span class="token comment"># work with shared resource</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># \u65B9\u6CD5\u4E8C\uFF1A\u624B\u52A8acquire\u3001release</span>
sem <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># ...later</span>
<span class="token keyword">await</span> sem<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
		<span class="token comment"># work with shared resource</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
		sem<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,26);function v(m,h){const a=c("ExternalLinkIcon");return p(),e("div",null,[u,n("p",null,[n("a",r,[d,o(a)])]),k])}var g=t(l,[["render",v],["__file","python-concurrent.html.vue"]]);export{g as default};
